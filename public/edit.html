<!DOCTYPE html>
<html>
<head>
    <title>Edit Your Product - CraftLink</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <a href="/" class="text-blue-600 hover:text-blue-800 mb-4 inline-block">← Back to Home</a>
        
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Edit Your Product</h1>
        
        <div class="bg-white p-6 rounded-lg shadow-md">
            <form id="editForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Product ID</label>
                    <input type="text" id="productId" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Enter your product ID (from WhatsApp)">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Price (₹)</label>
                    <input type="number" id="price" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Enter new price">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea id="description" rows="4"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Enter new description"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Update Image</label>
                    <input type="file" id="image" accept="image/*" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                
                <button type="submit" 
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                    Update Product
                </button>
            </form>
            
            <div id="message" class="mt-4 hidden"></div>
            
            <div id="productInfo" class="mt-6 hidden">
                <h3 class="text-lg font-semibold mb-2">Product Information</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-50 p-3 rounded">
                        <span class="text-sm text-gray-600">Title:</span>
                        <p id="infoTitle" class="font-medium"></p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded">
                        <span class="text-sm text-gray-600">Current Price:</span>
                        <p id="infoPrice" class="font-medium"></p>
                    </div>
                </div>
                <div class="bg-gray-50 p-3 rounded mt-2">
                    <span class="text-sm text-gray-600">Description:</span>
                    <p id="infoDescription" class="mt-1"></p>
                </div>
                <div class="mt-3">
                    <a id="infoLink" href="#" target="_blank" class="text-blue-600 hover:text-blue-800">
                        View Product Page →
                    </a>
                </div>
            </div>
        </div>
        
        <div class="mt-8 bg-yellow-50 p-4 rounded-lg">
            <h2 class="text-lg font-semibold mb-2">Don't know your Product ID?</h2>
            <p class="text-gray-600">Send "myproducts" on WhatsApp to get your product IDs</p>
            <p class="text-gray-600 mt-1">Example: <code class="bg-gray-100 px-2 py-1 rounded">edit abc123 price 500</code></p>
        </div>
    </div>

    <script>
    // Fetch product info when ID is entered
    document.getElementById('productId').addEventListener('blur', async function() {
        const productId = this.value.trim();
        if (!productId) return;
        
        try {
            const response = await fetch(`http://localhost:8001/api/products/${productId}`);
            const result = await response.json();
            
            if (result.success) {
                document.getElementById('productInfo').classList.remove('hidden');
                document.getElementById('infoTitle').textContent = result.product.title;
                document.getElementById('infoPrice').textContent = '₹' + result.product.price;
                document.getElementById('infoDescription').textContent = result.product.description;
                document.getElementById('infoLink').href = `https://neethi-saarathi-ids.web.app/product/${productId}.html`;
                
                // Pre-fill form fields
                document.getElementById('price').value = result.product.price;
                document.getElementById('description').value = result.product.description;
            }
        } catch (error) {
            // Product not found or API not available
            document.getElementById('productInfo').classList.add('hidden');
        }
    });

    document.getElementById('editForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const productId = document.getElementById('productId').value;
        const price = document.getElementById('price').value;
        const description = document.getElementById('description').value;
        const imageFile = document.getElementById('image').files[0];
        
        const messageDiv = document.getElementById('message');
        messageDiv.className = 'mt-4 p-4 rounded-md hidden';
        
        try {
            const formData = new FormData();
            formData.append('product_id', productId);
            if (price) formData.append('price', price);
            if (description) formData.append('description', description);
            if (imageFile) formData.append('image', imageFile);
            
            const response = await fetch('http://localhost:8001/api/edit-product', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
                messageDiv.className = 'mt-4 p-4 bg-green-100 text-green-700 rounded-md';
                messageDiv.innerHTML = `✅ ${result.message}<br>`;
                if (result.product) {
                    messageDiv.innerHTML += `<a href="${result.product.shop_url}" target="_blank" class="text-blue-600 underline">View Updated Product</a>`;
                }
            } else {
                messageDiv.className = 'mt-4 p-4 bg-red-100 text-red-700 rounded-md';
                messageDiv.textContent = `❌ ${result.message}`;
            }
            
        } catch (error) {
            messageDiv.className = 'mt-4 p-4 bg-red-100 text-red-700 rounded-md';
            messageDiv.textContent = '❌ Error updating product. Please try again.';
        }
    });
    </script>
</body>
</html>